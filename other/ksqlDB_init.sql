CREATE STREAM healthRecordStream (citizenid INT, timestamp TIMESTAMP, heart_rate DOUBLE, blood_pressure_systolic DOUBLE, blood_pressure_diastolic DOUBLE, spo2 DOUBLE, ECG DOUBLE, record_type INT) WITH (kafka_topic='healthRecord-topic', value_format='json', partitions=1);
CREATE TABLE HEALTHRECORDAVERAGE_5S AS SELECT citizenid, AS_VALUE(citizenid) AS id, AVG(heart_rate) as heartrateaverage, AVG(SPO2) as oxygensaturationaverage, AVG(blood_pressure_systolic) as bloodpressuresystolicaverage, AVG(blood_pressure_diastolic) as bloodpressurediastolicaverage, collect_list(ECG) as ecgaggregation FROM HEALTHRECORDSTREAM WINDOW TUMBLING (SIZE 5 SECONDS) GROUP BY citizenid EMIT FINAL;
